generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Employee {
  id Int @id @default(autoincrement())
  first_name String @default("")
  last_name String @default("")
  division String @default("")
  employee_no String @default("")
  department  Department @relation(fields: [department_id], references: [id], onDelete: Cascade)
  department_id Int @default(1)
  cost_center_code String @default("")
  company     Company    @relation(fields: [company_id], references: [id], onDelete: Cascade)
  company_id   Int @default(1)
  date_hired DateTime @default(now())
  effective_from DateTime @default(now())
  effective_to DateTime @default("2099-12-01T00:00:00Z")
  modified_on DateTime @updatedAt
  date_entry DateTime @default(now())
  registered Boolean @default(false)
  deleted Boolean @default(false)
  modified_by_id Int? 
  modified_by User? @relation("EmployeeModifiedBy", fields: [modified_by_id], references: [id], onDelete: Cascade)
  users User[]

  @@index([first_name, last_name, employee_no])
}

model Store {
  id Int @id @default(autoincrement())
  company     Company    @relation(fields: [company_id], references: [id], onDelete: Cascade)
  company_id   Int @default(1)
  name String
  cost_center_code String
  address String
  registered Boolean @default(false)
  deleted Boolean @default(false)
  effective_from DateTime @default(now())
  effective_to DateTime @default("2099-12-01T00:00:00Z")
  modified_on DateTime @updatedAt
  modified_by_id Int? 
  modified_by User? @relation("StoreModifiedBy", fields: [modified_by_id], references: [id], onDelete: Cascade)
  users User[]

  @@index([name, cost_center_code])
}

model UserType {
  id          Int       @id @default(autoincrement())
  name        String
  deliveries Delivery[]
  deleted Boolean @default(false)
  effective_from DateTime @default(now())
  effective_to DateTime @default("2099-12-01T00:00:00Z")
  modified_on DateTime @updatedAt
  modified_by_id Int? 
  modified_by User? @relation("UserTypeModifiedBy", fields: [modified_by_id], references: [id], onDelete: Cascade)
}


model User {
  id Int @id @default(autoincrement())
  employee_id Int?  // nullable foreign key to Employee
  store_id    Int?  // nullable foreign key to Store
  Employee   Employee? @relation(fields: [employee_id], references: [id])
  Store      Store?   @relation(fields: [store_id], references: [id])
  role_id Int
  role UserRole @relation(fields: [role_id], references: [id], onDelete: Cascade)
  name String
  username String @unique
  password String
  department  Department @relation(fields: [department_id], references: [id], onDelete: Cascade)
  department_id Int @default(1)
  cost_center_code String
  employee_no String
  division String
  deleted Boolean @default(false)
  effective_from DateTime @default(now())
  effective_to DateTime @default("2099-12-01T00:00:00Z")
  modified_on DateTime @updatedAt
  modified_by_id  Int? @default(1)       // Foreign key to Employee.id
  modified_by     User?  @relation("UserModifiedBy", fields: [modified_by_id], references: [id])
  modified_users User[] @relation("UserModifiedBy")
  modified_employees Employee[] @relation("EmployeeModifiedBy")
  modified_stores Store[] @relation("StoreModifiedBy")
  modified_user_roles UserRole[] @relation("UserRoleModifiedBy")
  modified_departments Department[] @relation("DepartmentModifiedBy")
  modified_companies Company[] @relation("CompanyModifiedBy")
  modified_suppliers Supplier[] @relation("SupplierModifiedBy")
  modified_materials Material[] @relation("MaterialModifiedBy")
  modified_inventories Inventory[] @relation("InventoryModifiedBy")
  modified_supplier_contacts Supplier_Contact_Details[] @relation("SupplierContactModifiedBy")
  modified_deliveries Delivery[] @relation("DeliveryModifiedBy")
  modified_releases Release[] @relation("ReleaseModifiedBy")
  users_delivery Delivery[] @relation("UserDelivery")
  shipped_by_release Release[] @relation("ShippedByRelease")
  received_by_release Release[] @relation("ReceivedByRelease")
  material_categories Material_Category[] @relation("MaterialCategoryModifiedBy")
  material_types Material_Type[] @relation("MaterialTypeModifiedBy")
  modified_user_types UserType[] @relation("UserTypeModifiedBy")
}

// TODO store, user

model UserRole {
  id          Int       @id @default(autoincrement())
  name        String
  users User[]
  deleted Boolean @default(false)
  effective_from DateTime @default(now())
  effective_to DateTime @default("2099-12-01T00:00:00Z")
  modified_on DateTime @updatedAt
  modified_by_id Int? 
  modified_by User? @relation("UserRoleModifiedBy", fields: [modified_by_id], references: [id], onDelete: Cascade)
}

model Department {
  id         Int       @id @default(autoincrement())
  name       String
  users User[]
  employees  Employee[]
  deleted Boolean @default(false)
  effective_from DateTime @default(now())
  effective_to DateTime @default("2099-12-01T00:00:00Z")
  modified_on DateTime @updatedAt
  modified_by_id Int?  @default(1)
  modified_by User? @relation("DepartmentModifiedBy", fields: [modified_by_id], references: [id], onDelete: Cascade)
  @@index([name])
}

model Company {
  id         Int       @id @default(autoincrement())
  name       String
  employees  Employee[]
  suppliers Supplier[]
  stores Store[]
  deleted Boolean @default(false)
  effective_from DateTime @default(now())
  effective_to DateTime @default("2099-12-01T00:00:00Z")
  modified_on DateTime @updatedAt
  modified_by_id Int? @default(1)
  modified_by    User? @relation("CompanyModifiedBy", fields: [modified_by_id], references: [id], onDelete: Cascade)
  @@index([name])
}

model Supplier {
  id              Int             @id @default(autoincrement())
  supplier_code   String
  company         Company         @relation(fields: [company_id], references: [id], onDelete: Cascade)
  company_id      Int
  address         String
  contract_term   String
  tin_number      String
  contact_id Int
  contact_details Supplier_Contact_Details @relation(fields: [contact_id], references: [id], onDelete: Cascade)
  deleted Boolean @default(false)
  effective_from DateTime @default(now())
  effective_to DateTime @default("2099-12-01T00:00:00Z")
  modified_on DateTime @updatedAt
  modified_by_id Int?      // Foreign key to Employee.id
  modified_by User? @relation("SupplierModifiedBy", fields: [modified_by_id], references: [id], onDelete: Cascade)
  deliveries Delivery[]

  @@index([supplier_code])
}

model Supplier_Contact_Details {
  id              Int             @id @default(autoincrement())
  contact_person String
  business_tel String
  email_address String
  telefax_number String
  zip_code String
  mobile_number String
  city_town String
  province String
  remarks String
  suppliers Supplier[] @relation
  deleted Boolean @default(false)
  effective_from DateTime @default(now())
  effective_to DateTime @default("2099-12-01T00:00:00Z")
  modified_on DateTime @updatedAt
  modified_by_id Int?      // Foreign key to Employee.id
  modified_by User? @relation("SupplierContactModifiedBy", fields: [modified_by_id], references: [id], onDelete: Cascade)
}

model Material {
  id Int @id @default(autoincrement())
  material_code String
  description String
  item_code String
  brand_model String
  material_required_yn String @db.Char(1)
  type_id Int
  type Material_Type @relation(fields: [type_id], references: [id], onDelete: Cascade)
  cost Int
  unit_of_measure String
  category_id Int
  category Material_Category @relation(fields: [category_id], references: [id], onDelete: Cascade)
  date_entry DateTime
  deleted Boolean @default(false)
  serial_number String @default("")
  asset_number String @default("")
  effective_from DateTime @default(now())
  effective_to DateTime @default("2099-12-01T00:00:00Z")
  modified_on DateTime @updatedAt
  modified_by_id Int?      // Foreign key to Employee.id
  modified_by User? @relation("MaterialModifiedBy", fields: [modified_by_id], references: [id], onDelete: Cascade)
  inventories Inventory[]
  deliveries Delivery[]
  release_details Release_Detail[]

  @@index([item_code, description, material_code])
}
model Inventory {
  id Int @id @default(autoincrement())
  material  Material  @relation(fields: [material_id], references: [id], onDelete: Cascade)
  material_id  Int @unique
  total_balance Int
  remaining_balance Int
  quantity_out Int
  available Int
  return Int
  effective_from DateTime @default(now())
  effective_to DateTime @default("2099-12-01T00:00:00Z")
  modified_on DateTime @updatedAt
  modified_by_id Int?      // Foreign key to Employee.id
  modified_by User? @relation("InventoryModifiedBy", fields: [modified_by_id], references: [id], onDelete: Cascade)
}

model Delivery {
  id Int @id @default(autoincrement())
  supplier Supplier @relation(fields: [supplier_id], references: [id], onDelete: Cascade)
  supplier_id Int
  material Material @relation(fields: [material_id], references: [id], onDelete: Cascade)
  user_type_id Int 
  user_type UserType @relation(fields: [user_type_id], references: [id], onDelete: Cascade)
  material_id Int
  remarks String
  quantity Int
  user User @relation("UserDelivery", fields: [user_id], references: [id], onDelete: Cascade)
  user_id Int
  requestor_id Int
  delivery_receipt_number String
  product_order_number String
  purchase_request_number String
  capex_number String
  deleted Boolean @default(false)
  effective_from DateTime @default(now())
  effective_to DateTime @default("2099-12-01T00:00:00Z")
  modified_on DateTime @updatedAt
  modified_by_id Int?      // Foreign key to Employee.id
  modified_by User? @relation("DeliveryModifiedBy", fields: [modified_by_id], references: [id], onDelete: Cascade)
}

model Release_Detail {
  release_number BigInt
  material Material @relation(fields: [material_id], references: [id], onDelete: Cascade)
  material_id Int 
  quantity Int
  remarks String
  release Release?  @relation(fields: [release_number], references: [release_number])

  @@id([release_number, material_id])
  @@index([release_number])
}

model Release {
  id Int @id @default(autoincrement())
  release_detail Release_Detail[]
  release_number BigInt @unique
  shipped_by User @relation("ShippedByRelease", fields: [shipped_by_id], references: [id], onDelete: Cascade)
  shipped_by_id Int
  received_by User @relation("ReceivedByRelease", fields: [received_by_id], references: [id], onDelete: Cascade)
  received_by_id Int
  received_date DateTime
  status Int
  remarks String
  deleted Boolean @default(false)
  effective_from DateTime @default(now())
  effective_to DateTime @default("2099-12-01T00:00:00Z")
  modified_on DateTime @updatedAt
  modified_by_id Int?      // Foreign key to Employee.id
  modified_by User? @relation("ReleaseModifiedBy", fields: [modified_by_id], references: [id], onDelete: Cascade)

  @@index([release_number])
}

model Material_Category {
  id         Int       @id @default(autoincrement())
  description       String
  deleted Boolean @default(false)
  effective_from DateTime @default(now())
  effective_to DateTime @default("2099-12-01T00:00:00Z")
  modified_on DateTime @updatedAt
  modified_by_id Int?  @default(1)
  modified_by User? @relation("MaterialCategoryModifiedBy", fields: [modified_by_id], references: [id], onDelete: Cascade)
  materials Material[]

  @@index([description])
}

model Material_Type {
  id         Int       @id @default(autoincrement())
  description       String
  deleted Boolean @default(false)
  effective_from DateTime @default(now())
  effective_to DateTime @default("2099-12-01T00:00:00Z")
  modified_on DateTime @updatedAt
  modified_by_id Int?  @default(1)
  modified_by User? @relation("MaterialTypeModifiedBy", fields: [modified_by_id], references: [id], onDelete: Cascade)
  materials Material[]

  @@index([description])
}
